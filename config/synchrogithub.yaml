# =============================================================================
# CONFIGURATION DE LA SYNCHRONISATION GIT AUTOMATIQUE
# =============================================================================
# Syst√®me de synchronisation automatique avec GitHub via watchdog.
# Surveille les modifications de fichiers et effectue des push automatiques.
#
# S√âCURIT√â : Le token GitHub est lu depuis la variable d'environnement
# GITHUB_TOKEN (d√©finie dans .env). Ne JAMAIS commiter le token en clair.
#
# UTILISATION :
#   - Pour lancer la synchronisation : ./sync_github.sh
#   - La synchronisation n'est PAS lanc√©e par start.sh (s√©paration des responsabilit√©s)
# =============================================================================

# -----------------------------------------------------------------------------
# ACTIVATION
# -----------------------------------------------------------------------------
git_sync:
  # Activation de la fonctionnalit√©
  enabled: true

  # Mode de synchronisation
  # - "sync" : Mode synchrone (bloquant) - Recommand√© pour v1
  # - "async" : Mode asynchrone (non-bloquant) - R√©serv√© pour v2
  mode: "async"

  # -----------------------------------------------------------------------------
  # FR√âQUENCE DE SYNCHRONISATION
  # -----------------------------------------------------------------------------
  frequency:
    # Type de d√©clenchement
    # - "immediate" : Push d√®s qu'un changement est d√©tect√©
    # - "debounce" : Attend X secondes d'inactivit√© avant de pusher (regroupe les modifs)
    # - "periodic" : Push toutes les X minutes si des changements existent
    type: "periodic"

    # D√©lai d'attente apr√®s le dernier changement (mode debounce)
    debounce_seconds: 30

    # Intervalle entre les push (mode periodic)
    periodic_interval_minutes: 15

  # -----------------------------------------------------------------------------
  # SURVEILLANCE DES FICHIERS
  # -----------------------------------------------------------------------------
  # Chemins surveill√©s (relatifs √† la racine du projet)
  watch_paths:
    - "."  # Racine du projet

  # Patterns d'exclusion (regex Python)
  # Ces fichiers/dossiers ne d√©clenchent PAS de synchronisation
  exclude_patterns:
    - ".*\\.git/.*"                    # Dossier .git (√©vite boucle infinie)
    - ".*\\.venv/.*"                   # Environnement virtuel
    - ".*/venv/.*"                     # Environnement virtuel alternatif
    - ".*__pycache__.*"                # Cache Python
    - ".*\\.pyc$"                      # Fichiers compil√©s Python
    - ".*\\.pytest_cache.*"            # Cache pytest
    - ".*\\.mypy_cache.*"              # Cache mypy
    - ".*\\.ruff_cache.*"              # Cache ruff
    - ".*/data/input/(?!.gitkeep).*"  # Contenu data/input (sauf .gitkeep)
    - ".*/data/output/(?!.gitkeep).*" # Contenu data/output (sauf .gitkeep)
    - ".*\\.DS_Store$"                 # Fichiers macOS
    - ".*\\.coverage$"                 # Couverture de tests
    - ".*/htmlcov/.*"                  # Rapport de couverture HTML
    - ".*/chroma_db/.*"                # Base de donn√©es Chroma
    - ".*\\.log$"                      # Fichiers de log

  # Patterns d'inclusion (regex Python)
  # Seuls ces fichiers d√©clenchent une synchronisation
  include_patterns:
    - ".*\\.py$"      # Fichiers Python
    - ".*\\.yaml$"    # Fichiers de configuration YAML
    - ".*\\.yml$"     # Fichiers de configuration YML
    - ".*\\.md$"      # Documentation Markdown
    - ".*\\.rst$"     # Documentation reStructuredText
    - ".*\\.txt$"     # Fichiers texte (requirements, etc.)
    - ".*\\.toml$"    # Fichiers de configuration (pyproject.toml)
    - ".*\\.gitignore$"  # Fichier gitignore
    - ".*\\.gitkeep$"    # Fichiers gitkeep

  # -----------------------------------------------------------------------------
  # CONFIGURATION DU REPOSITORY GIT
  # -----------------------------------------------------------------------------
  repository:
    # URL du repository distant (lue depuis git remote -v si non sp√©cifi√©e)
    url: "https://github.com/dagornc/rag2025.git"  # Optionnel

    # Branche cible pour les push
    branch: "main"

    # Nom du remote Git
    remote: "origin"

    # Cr√©er automatiquement des fichiers .gitkeep dans data/input et data/output
    # pour pr√©server l'arborescence sans commiter le contenu
    auto_create_gitkeep: true

  # -----------------------------------------------------------------------------
  # CONFIGURATION DES COMMITS
  # -----------------------------------------------------------------------------
  commit:
    # Template du message de commit
    # Variables disponibles : ${timestamp}, ${file_count}, ${operation}, ${files}
    message_template: "ü§ñ Auto-sync: ${file_count} fichier(s) modifi√©(s) - ${timestamp}"

    # Auteur des commits automatiques
    author_name: "RAG Framework Bot"
    author_email: "cdagorn3@gmail.com"

    # Inclure la liste des fichiers modifi√©s dans le message de commit
    include_file_list: true

    # Nombre maximum de fichiers √† lister dans le message
    max_files_in_message: 10

  # -----------------------------------------------------------------------------
  # GESTION DES ERREURS
  # -----------------------------------------------------------------------------
  error_handling:
    # Nombre de tentatives en cas d'√©chec du push
    max_retries: 3

    # D√©lai entre les tentatives (secondes)
    retry_delay_seconds: 5

    # Continuer la surveillance m√™me en cas d'erreur de push
    continue_on_error: true

  # -----------------------------------------------------------------------------
  # LOGGING SP√âCIFIQUE
  # -----------------------------------------------------------------------------
  logging:
    # Niveau de log (DEBUG, INFO, WARNING, ERROR, CRITICAL)
    level: "INFO"

    # Fichier de log d√©di√© (en plus du log global)
    log_file: "logs/git_sync.log"

    # Activer les logs structur√©s JSON
    structured: true
